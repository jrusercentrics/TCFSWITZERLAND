<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Cookiebot + TCF Debug (Workaround gdprApplies=true)</title>
  <script>
    // Ativar suporte TCF no gtag (necess√°rio p/ Google Ads/Analytics)
    window['gtag_enable_tcf_support'] = true;
  </script>

  <!-- Cookiebot CMP -->
  <script
    id="Cookiebot"
    src="https://consent.cookiebot.com/uc.js"
    data-cbid="e2769309-3672-42d4-bc3f-d56333e6a880"
    data-blockingmode="auto"
    data-framework="TCFv2.2"
    type="text/javascript"
    async>
  </script>
  <!-- End Cookiebot CMP -->

  <script>
    // Workaround: for√ßar gdprApplies=true em todas as chamadas √† __tcfapi
    window.addEventListener("CookiebotOnConsentReady", function() {
      if (typeof __tcfapi !== "undefined") {
        const originalTcfApi = __tcfapi;
        window.__tcfapi = function(command, version, callback, parameter) {
          originalTcfApi(command, version, function(tcData, success) {
            if (success && tcData && tcData.gdprApplies === false) {
              tcData.gdprApplies = true; // üöß For√ßa workaround
            }
            callback(tcData, success);
          }, parameter);
        };
        console.log("‚ö†Ô∏è Workaround ativo: for√ßando gdprApplies=true");
      }
    });

    // Fun√ß√£o de logging
    function log(message, data) {
      console.log(message, data || '');
      const out = document.getElementById("output");
      out.textContent += message + (data ? " " + JSON.stringify(data, null, 2) : "") + "\n\n";
    }

    // Checar estado atual
    function checkConsent() {
      log("=== CHECK CONSENT ===");

      if (window.Cookiebot && Cookiebot.consent) {
        log("Cookiebot.consent:", Cookiebot.consent);
        log("Cookiebot.consent.tcString:", Cookiebot.consent.tcString);
      } else {
        log("Cookiebot not ready yet.");
      }

      if (typeof __tcfapi !== "undefined") {
        __tcfapi('getTCData', 2, (tcData, success) => {
          log("__tcfapi getTCData (success=" + success + "):", tcData);
        });

        __tcfapi('getVendorConsents', 2, (vendorData, success) => {
          log("__tcfapi getVendorConsents (success=" + success + "):", vendorData);
        });

        __tcfapi('getInAppTCData', 2, (inAppData, success) => {
          log("__tcfapi getInAppTCData (success=" + success + "):", inAppData);
        });
      } else {
        log("__tcfapi not available");
      }
    }

    // Listener para eventos TCF
    function registerListener() {
      if (typeof __tcfapi !== "undefined") {
        __tcfapi('addEventListener', 2, (tcData, success) => {
          if (success) {
            log("=== TCF Event Listener triggered ===", tcData);
          }
        });
      } else {
        log("Cannot register listener, __tcfapi undefined");
      }
    }

    document.addEventListener("DOMContentLoaded", () => {
      setTimeout(registerListener, 2000);
    });
  </script>
</head>
<body>
  <h1>Cookiebot TCF Debug (Workaround gdprApplies=true)</h1>
  <button onclick="checkConsent()">Check Consent Now</button>
  <pre id="output" style="background:#111;color:#0f0;padding:10px;max-height:70vh;overflow:auto;"></pre>
</body>
</html>
