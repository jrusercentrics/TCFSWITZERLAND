<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Cookiebot + TCF Debug (gdprAppliesOverride)</title>

  <!-- ⚡ Workaround: define antes do Cookiebot -->
  <script>
    window['gtag_enable_tcf_support'] = true;
    window.gdprAppliesOverride = true; // <--- ESTE É O WORKAROUND
  </script>

  <!-- Cookiebot CMP -->
  <script
    id="Cookiebot"
    src="https://consent.cookiebot.com/uc.js"
    data-cbid="e2769309-3672-42d4-bc3f-d56333e6a880"
    data-blockingmode="auto"
    data-framework="TCFv2.2"
    type="text/javascript"
    async>
  </script>

  <script>
    function log(message, data) {
      console.log(message, data || '');
      const out = document.getElementById("output");
      out.textContent += message + (data ? " " + JSON.stringify(data, null, 2) : "") + "\n\n";
    }

    function checkConsent() {
      log("=== CHECK CONSENT ===");

      if (window.Cookiebot && Cookiebot.consent) {
        log("Cookiebot.consent:", Cookiebot.consent);
        log("Cookiebot.consent.tcString:", Cookiebot.consent.tcString);
        log("Cookiebot.IABConsentString:", Cookiebot.IABConsentString);
      }

      if (typeof __tcfapi !== "undefined") {
        __tcfapi('getTCData', 2, (tcData, success) => {
          log("__tcfapi getTCData (success=" + success + "):", tcData);
        });
      }
    }

    function registerListener() {
      if (typeof __tcfapi !== "undefined") {
        __tcfapi('addEventListener', 2, (tcData, success) => {
          if (success) log("=== TCF Event Listener triggered ===", tcData);
        });
      }
    }

    document.addEventListener("DOMContentLoaded", () => {
      setTimeout(registerListener, 2000);
    });
  </script>
</head>
<body>
  <h1>Cookiebot TCF Debug (Workaround: gdprAppliesOverride=true)</h1>
  <button onclick="checkConsent()">Check Consent Now</button>
  <pre id="output" style="background:#111;color:#0f0;padding:10px;max-height:70vh;overflow:auto;"></pre>
</body>
</html>
