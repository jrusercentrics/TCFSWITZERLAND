<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Cookiebot TCF Debug (CH vs DE)</title>
  <script id="CookiebotConfiguration" type="application/json" data-cookieconsent="ignore">
  {
    "Frameworks": {
      "IABTCF2": {
        "GdprApplies": true
      }
    }
  }
</script>
  <!-- Cookiebot CMP -->
  <script
    id="Cookiebot"
    src="https://consent.cookiebot.com/uc.js"
    data-cbid="e2769309-3672-42d4-bc3f-d56333e6a880"
    data-blockingmode="auto"
    data-framework="TCFv2.2"
    type="text/javascript"
    async>
  </script>

  <!-- Workaround para CH -->


  <script>
    function log(message, data) {
      console.log(message, data || '');
      const out = document.getElementById("output");
      out.textContent += message + (data ? " " + JSON.stringify(data, null, 2) : "") + "\n\n";
    }

    function checkConsent() {
      log("=== CHECK CONSENT ===");

      // Estado Cookiebot
      if (window.Cookiebot) {
        log("Cookiebot.userCountry:", Cookiebot.userCountry);
        log("Cookiebot.regulationRegions:", Cookiebot.regulationRegions);
        log("Cookiebot.regulations:", Cookiebot.regulations);
        log("Cookiebot.consent:", Cookiebot.consent);
        log("Cookiebot.consent.tcString:", Cookiebot.consent.tcString);
        log("Cookiebot.IABConsentString:", Cookiebot.IABConsentString);
        log("Cookiebot.consent.publisherCC:", Cookiebot.consent?.publisherCC);
      } else {
        log("Cookiebot not ready yet.");
      }

      // Estado TCF API
      if (typeof __tcfapi !== "undefined") {
        __tcfapi('getTCData', 2, (tcData, success) => {
          log("__tcfapi getTCData (success=" + success + "):", tcData);
          log("TCData.publisherCC:", tcData?.publisherCC);
        });

        __tcfapi('getVendorConsents', 2, (vendorData, success) => {
          log("__tcfapi getVendorConsents (success=" + success + "):", vendorData);
        });

        __tcfapi('getInAppTCData', 2, (inAppData, success) => {
          log("__tcfapi getInAppTCData (success=" + success + "):", inAppData);
        });
      } else {
        log("__tcfapi not available");
      }
    }

    function registerListener() {
      if (typeof __tcfapi !== "undefined") {
        __tcfapi('addEventListener', 2, (tcData, success) => {
          if (success) {
            log("=== TCF Event Listener triggered ===", tcData);
            log("publisherCC (listener):", tcData?.publisherCC);
          }
        });
      }
    }

    document.addEventListener("DOMContentLoaded", () => {
      setTimeout(registerListener, 2000);
    });
  </script>
</head>
<body>
  <h1>Cookiebot TCF Debug (Comparar DE vs CH)</h1>
  <button onclick="checkConsent()">Check Consent Now</button>
  <pre id="output" style="background:#111;color:#0f0;padding:10px;max-height:70vh;overflow:auto;"></pre>
</body>
</html>
